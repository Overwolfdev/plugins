<!-- markdownlint-disable -->
<!-- ![Sapphire Logo](https://raw.githubusercontent.com/OverWolfDev/assets/main/banners/SapphireCommunity.png) -->

# @overwolfdev/plugin-subcommands-advanced

<div align="center">

[![GitHub](https://img.shields.io/github/license/overwolfdev/plugins)](https://github.com/overwolfdev/plugins/blob/main/LICENSE.md)
[![codecov](https://codecov.io/gh/overwolfdev/plugins/branch/main/graph/badge.svg?token=QWL8FB16BR)](https://codecov.io/gh/overwolfdev/plugins)
[![npm bundle size](https://img.shields.io/bundlephobia/min/@overwolfdev/plugin-subcommands-advanced?logo=webpack&style=flat-square)](https://bundlephobia.com/result?p=@overwolfdev/plugin-subcommands-advanced)
[![npm](https://img.shields.io/npm/v/@overwolfdev/plugin-subcommands-advanced?color=crimson&logo=npm&style=flat-square)](https://www.npmjs.com/package/@overwolfdev/plugin-subcommands-advanced)

</div>

## Description

This plugin allows you to manage the subcommands of a parent command based on the classes of the commands in a simple way.

Currently the problem with the original subcommand plugin is that you have to put all the methods of the subcommands in the same class of the parent command, which can be a problem if the parent command has many subcommands or subcommand groups.

This plugin allows you to modularize the subcommands of a parent command into several command classes and also allows you to use different preconditions on each subcommand.

<div>

## Features

-   Fully ready for TypeScript!
-   Includes ESM ready entrypoint
-   Easy to use
-   Support for preconditions.
-   Based on command class.
-   Everything included in the original subcommand plugin.

## Installation

`@overwolfdev/plugin-subcommands-advanced` depends on the following packages. Be sure to install these along with this package!

-   [`@sapphire/framework`](https://www.npmjs.com/package/@sapphire/framework)
-   [`@sapphire/plugin-subcommands`](https://github.com/sapphiredev/plugins/tree/main/packages/subcommands)

You can use the following command to install this package, or replace `npm install` with your package manager of choice.

```sh
npm install @sapphire/framework @sapphire/plugin-subcommands @overwolfdev/plugin-subcommands-advanced
```

---

## Usage

### JavaScript

In your main or setup file, register the plugin:

```javascript
require('@overwolfdev/plugin-subcommands-advanced/register');
```

Once the plugin is registered, we have to configure some options.

```javascript
async function main() {
	const client = new SapphireClient({
		subcommandsAdvanced: {
			/* All options are optionals */
			nameCommandsAutogenerated: true
			/* more optional options.... */
		}
	});

	await client.login();
}

void main();
```

### TypeScript

In your main or setup file, register the plugin:

```typescript
import '@overwolfdev/plugin-subcommands-advanced/register';
```

Once the plugin is registered, we have to configure some options.

```typescript
async function main() {
	const client = new SapphireClient({
		subcommandsAdvanced: {
			/* All options are optionals */
			nameCommandsAutogenerated: true
			/* more optional options.... */
		}
	});

	await client.login();
}

void main();
```

For a good user experience (UX), it is necessary to follow the following file structure. The directory order is not required, but is recommended.

```typescript
commands
└── utils
    ├── parent.js // Parent command of the subcommand and subcommand groups.

    ├── ping.js // Subcommand of the parent command.

    └── poll // Subcommand group name.
        └── create.js // Subcommand of the poll subcommand group.
```

## Parent Command

The parent command is important because it is where the subcommands and subcommand group will be registered and is necessary for `@sapphire/framework` to know what to do with the subcommands.

### TypeScript

```typescript
import { Subcommand } from '@overwolfdev/plugin-subcommands-advanced';
import { ApplicationCommandRegistry } from '@sapphire/framework';

export class ParentCommand extends Subcommand {
  public constructor(context: Submmand.Context, options: Subcommand.Options) {
   super(context, {
    ...options,
    name: 'utils',
   preconditions: [] // The preconditions set here affect all subcommands.
   });
  }

  public override registerApplicationCommands(registry: ApplicationCommandRegistry) {
   registry.registerChatInputCommand(
   (ctx) => {
    // If you want to link commands in groups of subcommands you first need to register them in the builder context of the parent command.
    ctx.addSubcommandGroup((sc) =>
     sc
      .setName('poll')
      .setDescription('Make awesome polls!')
    );

    // It is necessary to call this hook and pass the builder context to register the subcommands stored in the subcommand registry in the subcommand groups of the parent command.
    this.hooks.groups(this, ctx);

    // It is necessary to call this hook and pass the builder context to register the subcommands stored in the subcommand register in the parent command.
    this.hooks.subcommands(this, ctx);

     // Calling both hooks is only necessary if required, it is not mandatory.
    return ctx
     .setName(this.name)
     .setDescription('Parent command of utils subcommands)
   }
  );
  }
}
```

### JavaScript

```javascript
import { Subcommand } from '@overwolfdev/plugin-subcommands-advanced';

export class ParentCommand extends Subcommand {
  constructor(context, options) {
   super(context, {
    ...options,
    name: 'utils',
   preconditions: [] // The preconditions set here affect all subcommands.
   });
  }

  registerApplicationCommands(registry) {
   registry.registerChatInputCommand(
   (ctx) => {
    // If you want to link commands in groups of subcommands you first need to register them in the builder context of the parent command.
    ctx.addSubcommandGroup((sc) =>
     sc
      .setName('poll')
      .setDescription('Make awesome polls!')
    );

    // It is necessary to call this hook and pass the builder context to register the subcommands stored in the subcommand registry in the subcommand groups of the parent command.
    this.hooks.groups(this, ctx);

    // It is necessary to call this hook and pass the builder context to register the subcommands stored in the subcommand register in the parent command.
    this.hooks.subcommands(this, ctx);

     // Calling both hooks is only necessary if required, it is not mandatory.
    return ctx
     .setName(this.name)
     .setDescription('Parent command of utils subcommands)
   }
  );
  }
 }
```

## Register the command as a subcommand in the parent command

To register commands as subcommands of the parent command it is necessary to use the `registerSubCommand` option of the command options.

### With Typescript

```typescript
import { Command } from '@overwolfdev/plugin-subcommands-advanced';
import type { Message } from 'discord.js';

export class PingCommand extends Command {
	public constructor(context: Command.Context, options: Command.Options) {
		super(context, {
			...options,
			preconditions: [], // The preconditions set here affect only the subcommand where it was established.
			registerSubCommand: {
				parentCommandName: 'utils', // Name of the parent command (parent.js).
				slashSubcommand: (builder) => builder.setName('ping').setDescription('Hi!') // Builder that will be embedded in the parent command registry to register the slash subcommand.
			}
		});
	}

	// It is only necessary if the `slashSubcommand` option of the `registerSubCommand` command options is used.
	public override chatInputRun(interaction: Command.ChatInputInteraction) {
		return interaction.reply('uwu');
	}

	// Optional if you want the subcommand to work for slash commands and message commands.
	public override messageRun(message: Message) {
		return message.reply('uwu');
	}
}
```

### With JavaScript

```javascript
import { Command } from '@overwolfdev/plugin-subcommands-advanced';

export class PingCommand extends Command {
	constructor(context, options) {
		super(context, {
			...options,
			preconditions: [], // The preconditions set here affect only the subcommand where it was established.
			registerSubCommand: {
				parentCommandName: 'utils', // Name of the parent command (parent.js).
				slashSubcommand: (builder) => builder.setName('ping').setDescription('Hi!') // Builder that will be embedded in the parent command registry to register the slash subcommand.
			}
		});
	}

	// It is only necessary if the `slashSubcommand` option of the `registerSubCommand` command options is used.
	chatInputRun(interaction) {
		return interaction.reply('uwu');
	}

	// Optional if you want the subcommand to work for slash commands and message commands.
	messageRun(message) {
		return message.reply('uwu');
	}
}
```

## Register a command as a subcommand of a group of subcommands of the parent command

To register commands as group subcommands it is important to first register the groups to be used in the main command.

### With Typescript

```typescript
import { Command } from '@overwolfdev/plugin-subcommands-advanced';

export class PollCreateCommand extends Command {
	public constructor(context: Command.Context, options: Command.Options) {
		super(context, {
			...options,
			preconditions: [], // The preconditions set here affect only the subcommand where it was established.
			registerSubcommmandInGroup: {
				parentCommandName: 'utils', // Name of the parent command (parent.js).
				groupName: 'poll', // Name of the group that was registered in the builder context of the parent command.
				slashSubcommand: (builder) => builder.setName('create').setDescription('Create a poll!') // Builder that will be embedded in the parent command registry to register the slash subcommand.
			}
		});
	}

	// It is only necessary if the `slashSubcommand` option of the `registerSubcommmandInGroup` command options is used.
	public override chatInputRun(interaction: Command.ChatInputInteraction) {
		return interaction.reply('uwu');
	}

	// Optional if you want the subcommand to work for slash commands and message commands.
	public override messageRun(message: Message) {
		return message.reply('uwu');
	}
}
```

### With JavaScript

```javascript
import { Command } from '@overwolfdev/plugin-subcommands-advanced';

export class PollCreateCommand extends Command {
	constructor(context, options) {
		super(context, {
			...options,
			preconditions: [], // The preconditions set here affect only the subcommand where it was established.
			registerSubcommmandInGroup: {
				parentCommandName: 'utils', // Name of the parent command (parent.js).
				groupName: 'poll', // Name of the group that was registered in the builder context of the parent command.
				slashSubcommand: (builder) => builder.setName('create').setDescription('Create a poll!') // Builder that will be embedded in the parent command registry to register the slash subcommand.
			}
		});
	}

	// It is only necessary if the `slashSubcommand` option of the `registerSubcommmandInGroup` command options is used.
	chatInputRun(interaction) {
		return interaction.reply('uwu');
	}

	// Optional if you want the subcommand to work for slash commands and message commands.
	messageRun(message) {
		return message.reply('uwu');
	}
}
```

## Decorators

The plugin also includes subcommand decorators so that TypeScript users can easily register subcommands.

### Subcommands

```typescript
import { RegisterSubCommand } from '@overwolfdev/plugin-subcommands-advanced';
import { Command } from '@overwolfdev/plugin-subcommands-advanced';

@RegisterSubCommand('utils', (builder) => builder.setName('ping').setDescription('Hi!'))
export class PingCommand extends Command {
	// It is only necessary if the `slashSubcommand` option of the `registerSubCommand` command options is used.
	public override chatInputRun(interaction: Command.ChatInputInteraction) {
		return interaction.reply('uwu');
	}

	// Optional if you want the subcommand to work for slash commands and message commands.
	public override messageRun(message: Message) {
		return message.reply('uwu');
	}
}
```

### Subcommands group

```typescript
import { RegisterSubCommandGroup } from '@overwolfdev/plugin-subcommands-advanced';
import { Command } from '@overwolfdev/plugin-subcommands-advanced';

@RegisterSubCommandGroup('utils', 'poll', (builder) => builder.setName('create').setDescription('Create a poll'))
export class PingCommand extends Command {
	// It is only necessary if the `slashSubcommand` option of the `registerSubcommmandInGroup` command options is used.
	public override chatInputRun(interaction: Command.ChatInputInteraction) {
		return interaction.reply('uwu');
	}

	// Optional if you want the subcommand to work for slash commands and message commands.
	public override messageRun(message: Message) {
		return message.reply('uwu');
	}
}
```

That's it, the plugin will take care of configuring everything so that when the subcommand of the parent command is called, the linked command is executed.

## Note

This plugin is not official from `@sapphire/framework`, so if you need additional help ping me in discord with my tag `@「BDL」RedStar` on the [@sapphire/framework discord server](https://discord.gg/sapphiredev).

<!-- ## Buy us some doughnuts

Sapphire Community is and always will be open source, even if we don't get donations. That being said, we know there are amazing people who may still want to donate just to show their appreciation. Thank you very much in advance!

We accept donations through Open Collective, Ko-fi, Paypal, Patreon and GitHub Sponsorships. You can use the buttons below to donate through your method of choice.

|   Donate With   |                       Address                       |
| :-------------: | :-------------------------------------------------: |
| Open Collective | [Click Here](https://sapphirejs.dev/opencollective) |
|      Ko-fi      |      [Click Here](https://sapphirejs.dev/kofi)      |
|     Patreon     |    [Click Here](https://sapphirejs.dev/patreon)     |
|     PayPal      |     [Click Here](https://sapphirejs.dev/paypal)     | -->

## Contributors

Please make sure to read the [Contributing Guide][contributing] before making a pull request.

Thank you to all the people who already contributed to Sapphire!

<a href="https://github.com/overwolfdev/plugins/graphs/contributors">
  <img src="https://contrib.rocks/image?repo=overwolfdev/plugins" />
</a>

[contributing]: https://github.com/OverWolfDev/.github/blob/main/.github/CONTRIBUTING.md
